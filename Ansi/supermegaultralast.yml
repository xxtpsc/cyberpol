---
- hosts: debsrv1
  become: yes
  tasks:
    - name: Install build dependencies (Debian/Ubuntu)
      apt:
        name:
          - build-essential
          - zlib1g-dev
          - libncurses5-dev
          - libgdbm-dev
          - libnss3-dev
          - libssl-dev
          - libreadline-dev
          - libffi-dev
          - libbz2-dev
          - libblkid-dev
          - libpopt-dev
          - libacl1-dev
          - libldap2-dev
          - libgnutls-dev
        state: present
        update_cache: yes
      when: ansible_facts['os_family'] == 'Debian'

    - name: Download Python 2.7.18 source
      get_url:
        url: https://www.python.org/ftp/python/2.7.18/Python-2.7.18.tgz
        dest: /tmp/Python-2.7.18.tgz

    - name: Extract Python 2.7.18 source
      unarchive:
        src: /tmp/Python-2.7.18.tgz
        dest: /tmp/
        remote_src: yes

    - name: Compile and install Python 2.7.18
      shell: ./configure --enable-unicode=ucs4 --enable-shared && make && make altinstall
      args:
        chdir: /tmp/Python-2.7.18
        executable: /bin/bash
        creates: /usr/local/bin/python2.7

    - name: Set shared Python library path
      shell: echo '/usr/local/lib' > /etc/ld.so.conf.d/python2.7.conf && ldconfig
      args:
        executable: /bin/bash

    - name: Download Samba 4.5.10 source code
      get_url:
        url: https://download.samba.org/pub/samba/stable/samba-4.5.10.tar.gz
        dest: /tmp/samba-4.5.10.tar.gz

    - name: Extract Samba source code
      unarchive:
        src: /tmp/samba-4.5.10.tar.gz
        dest: /tmp/
        remote_src: yes

    - name: Compile and install Samba 4.5.10
      shell: ./configure && make && make install
      args:
        chdir: /tmp/samba-4.5.10
        executable: /bin/bash
        creates: /usr/local/samba/sbin/smbd
